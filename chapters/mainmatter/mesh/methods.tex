
\section{方法}
\label{sec:mesh_methods}

\subsection{概观}
\label{subsec:mesh_overview}

本节讨论优化构成血管表面模型的多边形网格的完整工作流程。
本章中用到的血管表面模型来自基于真实病例的CTA影像数据，该工作的具体细节参见本文第\ref{chap:aorta}章。
为了顺利地将血管模型应用于虚拟交互的环境中，考虑到计算机图形硬件性能的限制，模型的数据量势必需要精简。
在这里，精简模型的数据量等同于在保持血管模型的原始几何特征不发生明显改变的前提下，尽可能地削减构成血管表面模型的多边形的数量。

图\ref{fig:mesh_data_flow}给出了在实际削减模型的多边形之前所必需完成的预处理工作的流程。
首先，需要对基于CTA的血管模型中的顶点的连接性进行检验，以确保要处理的表面是一体的，并且其中所有的顶点都是连通的。
其次，引入平滑算法以处理模型表面的“毛刺”和“凹陷”等不平整的区域。
最后，对表面模型的多边形面片进行削减，同时，血管模型的几何特征得到最大限度的保护。

\subsection{表面顶点的连接性检验}
\label{subsec:mesh_connectivity}

Before any processing steps, one routine must be done to ensure that the surface model considered is well-shaped that no extra polygons exist in defining the same piece of surface.
This routine is designed to extract the polygons based on the geometric connectivity.
Concretely, it can extract the cells (i.e., polygons and/or triangles) that share the common points (i.e., vertices).

\subsection{表面的平滑处理}
\label{subsec:mesh_smoothing}

In the field of computer graphics and imaging, the visualization of curves and surfaces (both will be referred to as \emph{shapes}) both in two- or three-dimensional space are common, especially for the volumetric data from medical field. %
The computation is in fact the proper approximation of the original shapes by the polygonal curves or polyhedral surfaces.
Typically, artifacts at certain level can be found in the resultant approximating shapes (see Fig. \ref{fig:mesh_artifact}), and can be smoothed while maintaining the overall geometry (see Fig. \ref{fig:mesh_artifact_removed}). %
In this work, one of our objectives is the smoothing or fairing of the model surface acquired by applying the iso-intensity extraction techniques on the raw medical images.
\begin{figure}[t]
\centering
\includegraphics[width=3.2in]{figures/mesh/DataFlow.eps}
\caption[血管表面模型优化的工作流程]{血管表面模型优化的工作流程}
\label{fig:mesh_data_flow}
\end{figure}
\begin{figure}[t]
\centering
\subfloat[]{\includegraphics[height=1.0in]{figures/mesh/artifact.eps}%
\label{fig:mesh_artifact}}
\hfil
\subfloat[]{\includegraphics[height=1.0in]{figures/mesh/artifact_removed.eps}%
\label{fig:mesh_artifact_removed}}
\caption[对可视化过程中引入的估计所带来的不平整区域进行平滑处理]{对可视化过程中引入的估计所带来的不平整区域进行平滑处理。(a) 不平整区域（血管模型表面上水平方向的“台阶”）；(b) 平滑处理后的该区域。}%
\label{fig:mesh_artifact_comparison}
\end{figure}
A signal processing approach is employed to fulfill this task.
The approach is actually a linear low-pass filtering technique \cite{Taubin1995ICCV}, which is a low-level processing in the field of digital signal processing.
It can be applied to the smoothing process on the curves/surfaces of arbitrary dimension and complexities in geometry.
Moreover, no shrinkages will be introduced by the method during the computation.

The method is built upon the concepts of \emph{discrete graph signal} and its three-dimensional counterpart, \emph{discrete surface signal} \cite{Taubin1995SIG}.

By discrete graph signal, it means that some functions defined on the directed graph (\emph{digraph} for short).
Corresponding the polyhedral surfaces in consideration, the digraph $G$ can be marked as $G: \left\{ V_g, E\right\}$, where $V_g = \left\{ 1, \ldots, n \right\}$ is \emph{vertex set} including all the vertices in the graph, labeled from $1$ to $n$; and $E$ is the \emph{edge set} including the edges between any pair of vertices in the set $V_g$. %
The so-called discrete graph signal is a $n$-dimensional vector $x = \left[ x_1, \ldots, x_n \right]^T$, where the component $x_i, i = 1, \ldots, n$ denotes the signal intensity at the vertex $i \in V_g$. %

By discrete surface signal, it means that some functions defined on the polyhedral surfaces.
The polyhedral surfaces $S$ can be represented as $S: \left\{ V_s, F\right\}$, where $V_s = \left\{ 1, \ldots, n \right\}$ is \emph{vertex set} including all the vertices in the polyhedral surfaces, marked from $1$ to $n$; and $F$ is the set including the faces surrounded by the vertices in the set $V_s$ and the edges connecting them. %
The discrete surface signal is a $n$-dimensional vector $y = \left[ y_1, \ldots, y_n \right]^T$, where the component $y_j, j = 1, \ldots, n$ corresponds to the signal value at the vertex $j \in V_s$. %

For the smoothing of the planar polygonal curves, the classical Fourier analysis can be applied to decompose the original curves into orthogonal subspaces with distinct frequencies. %
After that, the components at high frequencies are removed as noises and the ones at low frequencies are left.
The idea can be extended to the case of the polyhedral surfaces with arbitrary topology.

For the discrete surface signal $y$, the weighted Laplacian operators for the vertices in $V_s$ are defined as
\begin{equation}
\label{eqn:mesh_laplacian}
\Delta y_i = \sum_{j \in i^{\ast}} w_{ij} \left( y_j - y_i \right),
\end{equation}
where $w_{ij}$ is the positive weight for $y_j - y_i$, and for any $i$, the sum of its weights are always one, $\sum_{j \in i^{\ast}} w_{ij} = 1$.
The matrix form of (\ref{eqn:mesh_laplacian}) is
\begin{equation}
\label{eqn:mesh_laplacian_matrix}
\Delta y = - K y,
\end{equation}
where $K = I - W$, with $W$ the matrix of weights and $I$ an identity matrix.
Here we define $0 \leq \lambda_1 \leq \ldots \leq \lambda_n \leq 2$ as the real eigenvalues of $K$, and $e_1, \ldots, e_n$ the corresponding unit right eigenvectors.

At this point, the low-pass filtering can be presented as the multiplication of the matrix function $f(K)$ by the input signal $y$:
\begin{equation}
\label{eqn:mesh_low_pass_equivalent}
y' = f(K) y.
\end{equation}
For any polynomial transfer function, the output signal in (\ref{eqn:mesh_low_pass_equivalent}) can be rewritten as
\begin{equation}
\label{eqn:mesh_low_pass_polynomial}
y' = \sum_{i=1}^{n} \rho_i f(k_i) e_i,
\end{equation}
where $\rho_i$ are the coefficients of the linear combination of the unit right eigenvectors of the input signal $y$: $y = \sum_{i} \rho_i e_i$.
In order to realize a low pass filter, $f(k_i)$ is designed to satisfy two conditions: for $k_i \in [0,2]$, $f(k_i) \approx 1$ for low frequencies; $f(k_i) \approx 0$ for high frequencies. %

The low-pass filtering mechanism can be achieved by adjusting the weights in the following polynomial approximation \cite{Taubin1996}:
\begin{equation}
\label{eqn:mesh_approximation}
f_{N}(k) = w_0 \frac{\theta}{\pi} T_0 (1 - k / 2) + w_n \sum_{n} \frac{2 \sin (n \theta)}{n \pi} T_n(1 - k / 2),
\end{equation}
where $\theta$ is the unique solution of $k = 2 (1 - \cos \theta)$ on $[0, \pi / 2]$, and $T_0(\cdot)$ and $T_n(\cdot)$ are the Chebyshev polynomials.
Here in this work, the weights in (\ref{eqn:mesh_approximation}) is adjusted to form a Hamming window \cite{Taubin1996}, which can be represented as follows:
\begin{equation}
\label{eqn:mesh_hamming}
w_n = 0.54 + 0.46 \cos (n \pi / (N + 1) ).
\end{equation}

After smoothing the surface, the normal vectors (\emph{normals} in short) are computed for each polygonal mesh.

\subsection{多边形面片的精简}
\label{subsec:mesh_decimation}

为了削减构成表面模型的多边形总数，我们采用了一种削减三角形网格的算法\cite{Schroeder1992}。
该算法削减一定数量的网格的思路是：首先删除坐标已经被检验的顶点，然后再通过在漏洞位置创建新的三角化网格来进行修补。

如图\ref{fig:mesh_five_classes}所示，所有的顶点被归为简单，复杂，以及拐角等三种类型。
其中，简单顶点又可以进一步被分为边缘顶点和边缘内部顶点。
\begin{figure}[t]
\centering
\subfloat[]{
\input{figuresrc/mesh/GeneralSimple}
\label{fig:mesh_general_simple}
}
\hfil
\subfloat[]{
\input{figuresrc/mesh/Complex}
\label{fig:mesh_complex}
}
\hfil
\subfloat[]{
\input{figuresrc/mesh/Boundary}
\label{fig:mesh_boundary}
}
\hfil
\subfloat[]{
\input{figuresrc/mesh/InteriorEdge}
\label{fig:mesh_interior_edge}
}
\hfil
\subfloat[]{
\input{figuresrc/mesh/Corner}
\label{fig:mesh_corner}
}
\caption[表面中的顶点位置的五种情形]{表面中的顶点位置的五种情形。(a) 一般简单情形；(b) 复杂情形；(c) 边缘情形；(d) 边缘内部情形；(e) 拐角情形。}%
\label{fig:mesh_five_classes}
\end{figure}
\begin{figure}[t]
\centering
\subfloat[]{
\input{figuresrc/mesh/SimpleReduction}
\label{fig:mesh_simple_reduction}
}
\hfil
\subfloat[]{
\input{figuresrc/mesh/BoundaryReduction}
\label{fig:mesh_boundary_reduction}
}
\caption[削减顶点所引起的多边形数量的减少]{削减顶点所引起的多边形数量的减少。(a) 一般简单情形：削减前的多边形数量：$6$，削减后的多边形数量：$4$；(b) 边缘情形：削减前的多边形数量：$5$，削减后的多边形数量：$4$。注意：在削减计算之前，红色的边并不属于表面。}%
\label{fig:mesh_reduction}
\end{figure}

为删除那些不重要的顶点，就需要设计某种判定准则，并将其应用于验证模型内所有潜在目标的几何特征。
首先，复杂顶点是必须保留的。
然后，其余的顶点就得通过检验来决定其保留与否。
对于不位于边缘和边缘内部的简单顶点来说，其与平均平面的距离是唯一的原则――如果该距离小于某个设定值，该顶点即被保留；反之，该顶点则被删除。
位于边缘和边缘内部的顶点也利用类似的方法来检验――如果这些类型的顶点到平均平面的距离小于某一设定值，那么该顶点同样被保留；反之，该顶点将被剔除。
一般情况下，位于拐角处的顶点被保留下来，用来保持削减结果表面对输入表面的几何特征的准确估计，或者留下那些在建模过程中所引入的“噪声”，稍后再采用更加妥当的方法进行处理。

一旦删除某个顶点与之关联的边，表面上就会留下一个（简单情形）或两个（边缘情形或者边缘内部情形）漏洞需要修补。
为了修补这些新生成的漏洞，算法会在这些区域中创建新的三角化网格，而这一步骤是在实际删除步骤开始之前就完成的。

对比这一过程前后的三角形面片的数量可知，对于一般简单顶点，边缘内部顶点，以及某些拐角顶点，减少了两个三角形面片；而对于边缘顶点的情形，只减少了一个三角形面片（见图\ref{fig:mesh_reduction}）。