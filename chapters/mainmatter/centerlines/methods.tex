
\section{方法}
\label{sec:centerlines_methods}

本节讨论血管表面模型中心线提取的处理流程，以及各个环节的原理。
在进行实际的中心线提取之前，我们需要对之前基于CTA的可视化模型进行降噪和平滑，以确保输入表面数据的质量。
这些对基于CTA的血管表面模型的预处理流程如图\ref{fig:centerlines_data_flow}所示。
首先，检验表面模型中各个顶点的连接性，从而获得最大连接区域。
第二，对检验后的表面进行平滑处理，以除去表面模型上的“毛刺”和“台阶”。
第三，计算所得表面模型的法向量，以表明表面的“内部”和“外部”。
最后，对表面模型进行细分。

\subsection{对基于CTA的表面模型的预处理}
\label{subsec:centerlines_preprocessing}

\subsubsection{连接性的检验与最大连接区域的提取}
\label{subsubsec:centerlines_connectivity}

在本章中，基于原始医学影像数据的血管表面模型通过第\ref{chap:aorta}章的工作获得。
为了寻找血管表面模型中的最大连接区域，就需要对模型上所有的顶点逐一进行检验。
这一步骤的工作机制是提取那些共享顶点的组成表面模型的多边形面片。
\begin{figure}[t]
\centering
\includegraphics[width=3.2in]{figures/centerlines/DataFlow.eps}
\caption[表面模型中心线提取的工作流程]{表面模型中心线提取的工作流程}
\label{fig:centerlines_data_flow}
\end{figure}

\subsubsection{表面的平滑处理与表面的法线的计算}
\label{subsubsec:centerlines_smoothing_normals}

在可视化领域中，许多方法都可用于表面模型的平滑处理。
为了克服表面渲染过程中所产生的“台阶”，我们引入了最优表面平滑算法。
通过扩展Fourier分析方法，该算法将这一问题转化为低通滤波计算。
该算法建立在离散信号图的基础上，这也意味着其中的函数是基于离散图的。
我们用有向图$G$表示问题中的多边形表面，由顶点$\left\{ 1, \ldots, n \right\}$，及其邻域$\left\{ i^{\ast}: i = 1, \ldots, n \right\}$所构成，其中顶点$i \in G$。
离散图信号可表为向量$x = \left[ x_1, \ldots, x_n \right]^T$，该向量的各个分量对应图中的各个顶点。
具有$n$个顶点的多边形表面$S = \{ V, F \}$可以看作是一有向图，其中向量$V$对应着顶点$n$的集合，而$F$对应着由连通的顶点所围成的多边形。
作为定义在关联图上的离散图信号，离散表面信号可以表示为定义在该多边形表面上的按段线性函数。
对于定义在表面模型上的离散表面信号的离散Fourier变换计算，我们可以通过将表面信号分解为如下Laplace矩阵的特征向量的一组线性组合：
\begin{equation}
\label{eqn:centerlines_laplacian}
\Delta x_i = \sum_{j \in i^{\ast}} w_{ij} \left( x_j - x_i \right),
\end{equation}
其中，$w_{ij}$是各差值$x_j - x_i$的正权值，而对于一个给定顶点$i$，其权值之和为一。
式(\ref{eqn:centerlines_laplacian})的矩阵形式如下：
\begin{equation}
\label{eqn:centerlines_laplacian_matrix}
\Delta x = - K x,
\end{equation}
其中，$K = I - W$, $I$为单位矩阵，$W$为加权矩阵$w_{ij}$。

取$0 \leq k_1 \leq \ldots \leq k_n \leq 2$作为矩阵$K$的特征值，$r_1, \ldots, r_n$为其对应的右特征向量，$d_1, \ldots, d_n$为这些特征向量的对偶基，$K$可表示为：
\begin{equation}
\label{eqn:centerlines_K}
K = \sum_{i} k_i r_i d_i^T.
\end{equation}
于是，存在一个离散图信号的唯一分解$x$，可以表示为
\begin{equation}
\label{eqn:centerlines_x}
x = \sum_{i} \hat{x}_i r_i,
\end{equation}
其中，$\hat{x}_i = d_i^T x$是$x$的离散Fourier变换.

根据信号处理理论，对信号$x$的滤波计算相当于以传递函数$f$为参考，改变该型号的频率分布：
\begin{equation}
\bar{x} = \sum_{i} f(k_i) \hat{x}_i r_i = \left( \sum_{i} f(k_i) r_i d_i^T \right) x.
\end{equation}
所谓的低通滤波机制可以通过调整下面的多项式估计中的权值来实现：
\begin{equation}
\label{eqn:centerlines_approximation}
f_{N}(k) = w_0 \frac{\theta}{\pi} T_0 (1 - k / 2) + w_n \sum_{n} \frac{2 \sin (n \theta)}{n \pi} T_n(1 - k / 2),
\end{equation}
其中，$\theta$是$k = 2 (1 - \cos \theta)$在$[0, \pi / 2]$上的唯一解，$T$是Chebyshev多项式。
在本章中，我们通过调整式(\ref{eqn:centerlines_approximation})中的权值实现了一个Hamming窗，表示如下：
\begin{equation}
\label{eqn:centerlines_hamming}
w_n = 0.54 + 0.46 \cos (n \pi / (N + 1) ).
\end{equation}

在完成表面的平滑处理之后，我们还计算了表面模型的法向量。

\subsubsection{表面细分}
\label{subsubsec:centerlines_subdivision}

为了细分平滑后的表面，我们采用了一种改进的butterfly策略\cite{Zorin1996}用于表面的细分处理。
该策略事实上是一种插值方法，业已被证明是一种对复杂――尤其是非规则――表面的细分处理问题行之有效的方法。
在这一环节中，我们的原则是改善输入表面的可视化效果，而不影响其原始的形状。
与二维三角化后的新顶点关联的标量值通过利用这里的插值策略来计算相邻顶点的权值之和而生成。
这些顶点位于构成细分蜡纸的邻域中，该蜡纸决定了策略的特征。
通过分析这些蜡纸，计算策略可以迅速辨别新顶点与其邻域的拓扑之间的关系。
表面上的正常位置和异常位置是两个最为重要的情形。
一旦完成初始的细分循环步骤，具有非六价的顶点的最大数目就不会多于一个。
三角化的各边的重点的新标量值通过下述细分策略来计算：
\begin{itemize}
\item 连接两个正常顶点的边；
\item 连接一个正常顶点和一个异常顶点的边；
\item 连接两个异常顶点的边；
\item 边缘处的边。
\end{itemize}
在上述情形中，只有第一种情形输入正常情况，而其余均属异常情况。

\subsection{中心线提取}
\label{subsec:centerlines_centerlines}

中心线，或中轴线，通常被定义为某物体内部的一条轨迹：
在二维情形中，它是物体最大内切圆圆心的轨迹；
在三维情形中，它是物体最大内切球球心的轨迹。
与此相反地，所有最大内切圆（或者最大内切球）的包络面就是包含这些圆（或者球）的物体的表面\cite{Amenta2001}。
我们引入了一种power crust算法\cite{Antiga2003}，该算法将中心线看作是模型表面内部的Voronoi图上的最短作用路径。
无论在二维还是三维空间中，Voronoi图都可以作为一个物体中心线的离散估计。
作用路径连接着Voronoi图中的两个顶点，该路径的线积分的最小化生成了一些列的中心点，这些中心点在局部使其到表面边缘的最短距离最大化。
为实现这个计算过程，该方法首先从一个Voronoi图上的起始点开始计算如下的Eikonal方程：
\begin{equation}
\label{eqn:centerlines_Voronoi}
\left| \nabla T \right| = \frac{1}{R(u)},
\end{equation}
其中，$T$表示到达时间，$R$是最大内切圆（最大内切球）在$T$时刻的半径，$u$是Voronoi图的参数空间。

完成上述计算之后，该方法通过计算下面的方程来获得中心线：
\begin{equation}
\label{eqn:centerlines_centerlines}
\frac{dc}{ds} = - \nabla T,
\end{equation}
其中，$c$表示中心线，$s$是$c$的参数空间。
事实上，式(\ref{eqn:centerlines_centerlines})所表示的计算过程等同于通过在Voronoi图上的各点应用最速下降法来寻找中心线。
