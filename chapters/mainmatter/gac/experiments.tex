
\section{主动脉内腔分割}
\label{sec:aorta_experiments}

\subsection{实验场景与数据}
\label{subsec:aorta_setup_data}

为了验证本章所提出的方法对于从CTA中分割主动脉内腔的有效性，并在此基础上获得尽可能满意的结果，我们应用不同的参数进行了实验。
首先，以DICOM格式存储的原始CTA序列要转换成XML格式。
然后，被转换后的数据被同时传输至生成特征图像和输入水平集的两个分支当中。
随后，这两个分支的计算结果作为测地活动轮廓的输入。
最后，利用行进立方体方法来实现分割结果的提取。
所有实验运行于一台配有Intel 2.83GHz Core 2 Quad CPU以及4GB内存的台式计算机上。

原始数据利用Siemens的SOMATOM Definition Flash CT来获取，该设备属于128排CT，图像帧间距为$0.6 \text{mm}$，帧内分辨率达$0.4 \times 0.4 \text{mm}^2$，即体素规格为$0.4 \times 0.4 \times 0.6 \text{mm}^3$。
该数据序列中含有病人的完整主动脉以及冠状动脉树状结构信息。
为了叙述方便，本章选取了其中的一帧来说明实验的主要过程。
在实验中，为了缩短计算时间，我们从原始序列中特意截取了含有主动脉及其主要分支的区域（见图\ref{fig:aorta_roi}）。
\begin{figure}[t]
\centering
\includegraphics[width=2.7in]{Figures/gac/ROI.eps}
\caption[原始图像的ROI提取]{原始图像的ROI提取。}
\label{fig:aorta_roi}
\end{figure}

% \begin{figure*}[t]
% \centering
% \subfloat[]{\includegraphics[width=1.2in]{Figures/gac/dcm_smoothing.eps}%
% \label{fig:aorta_smoothing}}
% \hfil
% \subfloat[]{\includegraphics[width=1.2in]{Figures/gac/dcm_gradient.eps}%
% \label{fig:aorta_gradient}}
% \hfil
% \subfloat[]{\includegraphics[width=1.2in]{Figures/gac/dcm_sigmoid.eps}%
% \label{fig:aorta_sigmoid}}
% \caption[特征图像的生成步骤]{特征图像的生成步骤：(a) 保护物体边缘的平滑处理（$\text{传导参数} = 9.0$）；(b) 基于Gaussian核的梯度幅值的计算（$\sigma = 0.9$）；(c) 利用S型函数进行非线性映射（$m = -3$, $n = 20$）。}
% \label{fig:aorta_potential_image_generation}
% \end{figure*}

分割主动脉内腔的完整处理流程的设计如图\ref{fig:aorta_data_flow}所示。
原始医学图像进行数据格式的转换之后，将作为同时开始的两项不同计算任务的输入：一项用于计算并生成边缘势场（即：特征图像），另一项用于生成距离图（即：初始水平集）。
这两项计算完成后，其结果即作为主动脉内腔分割的核心环节的输入数据，为该环节提供演进计算的参考。
最后，分割所得结果（即：主动脉内腔的边缘）经过亮度的反转变换，再利用行进立方体方法提取其等值面，最终通过表面渲染技术获得主动脉内腔模型的立体可视效果。
\begin{figure}[t]
\centering
\input{FigureSrc/gac/data_flow}
% \includegraphics[width=3.2in]{Figures/gac/DataFlow.eps}
\caption[主动脉内腔分割流程]{主动脉内腔分割流程。}
\label{fig:aorta_data_flow}
\end{figure}

\subsection{预处理}
\label{subsec:aorta_preprocessing}

对原始图像的若干预处理工作需要在主要的处理工作开始之前完成。
考虑到本节分割工作所选取方法的需求，预处理应当包括特征图像的生成，以及输入水平集的生成。
特征图像为测地活动轮廓方法提供轮廓演进的终止位置，这正如一幅“地图”，其中标出何处是“平原”（指像素亮度均匀一致的区域），何处是“峡谷”（指像素亮度明显有别于周围的狭长区域）；
而输入水平集则为测地活动轮廓方法提供轮廓演进的起始轮廓，活动轮廓的最初位置由输入水平集所确定，输入水平集主要提供“到达时间”等信息。

\subsubsection{特征图像计算}
\label{subsec:aorta_feature_image}

在计算特征图像的分支中，我们需要逐个完成下面的三个任务：
\begin{enumerate}
\item 在不对边缘造成影响的前提下除去图像中的噪声；
\item 计算各像素的梯度的幅值；
\item 将梯度幅值图像映射为满足需要的特征图像。
\end{enumerate}

首先，我们利用具有可变传导性的水平集曲率方法进行图像的平滑降噪处理。
该方法作为一种保护边缘的平滑方法，能够在有效除去图像中的噪声的同时，很好地保护目标物体的边缘特征。
从图\ref{fig:aorta_smoothing}中可以看到，图像中的噪声得到了有效的抑制，而主动脉甚至是一些相对细小的血管（意味着较为薄弱的边缘）都得到了保持。
然后，我们引入梯度幅值模块来进行图像中各像素的梯度幅值计算。
该计算通过对式(\ref{eqn:imaging_magnitude})中所定义的运算来实现。
从图\ref{fig:aorta_gradient}中可以看到，血管，骨骼，以及皮肤的边缘处的梯度幅值较高（意味着较大的亮度变化）。
完成梯度幅值的计算之后，我们采用了一个非线性的映射关系来生成所需的特征图像。
式(\ref{eqn:imaging_sigmoid})是一个S型函数，在这里，参数的选择极大地依赖于梯度幅值图像中像素亮度的极值。
在本文中，为了实现目标物体（梯度幅值图像中亮度较低区域）与其边缘（梯度幅值图像中亮度较高区域）的反转，$m$必须设定为一个负数，$n$必须设定为一个正数，且$n > |m|$。
通过这个映射获得的特征图像如图\ref{fig:aorta_sigmoid}所示，其中的目标物体的边缘均为低亮度，而其所包围的区域则为高亮度。
这使得随后进行的由式(\ref{eqn:aorta_geodesic_3})所驱动的水平集演进在“平坦区域”（具有均一的高亮度）内速度较快，而在“峡谷”（具有急剧减低的亮度）附近速度极慢（接近于零）。
\begin{figure*}[t]
\centering
\subfloat[]{\includegraphics[width=1.2in]{Figures/gac/dcm_smoothing.eps}%
\label{fig:aorta_smoothing}}
\hfil
\subfloat[]{\includegraphics[width=1.2in]{Figures/gac/dcm_gradient.eps}%
\label{fig:aorta_gradient}}
\hfil
\subfloat[]{\includegraphics[width=1.2in]{Figures/gac/dcm_sigmoid.eps}%
\label{fig:aorta_sigmoid}}
\caption[特征图像的生成步骤]{特征图像的生成步骤：(a) 保护物体边缘的平滑处理（$\text{传导参数} = 9.0$）；(b) 基于Gaussian核的梯度幅值的计算（$\sigma = 0.9$）；(c) 利用S型函数进行非线性映射（$m = -3$, $n = 20$）。}
\label{fig:aorta_potential_image_generation}
\end{figure*}

% \begin{figure*}[t]
% \centering
% \subfloat[]{\includegraphics[width=1.2in]{Figures/gac/dcm_threshold.eps}%
% \label{fig:aorta_threholding}}
% \hfil
% \subfloat[]{\includegraphics[width=1.2in]{Figures/gac/dcm_fastMarching.eps}%
% \label{fig:aorta_Fast_Marching}}
% \hfil
% \subfloat[]{\includegraphics[width=1.2in]{Figures/gac/dcm_geodesic.eps}%
% \label{fig:aorta_geodesic_active_contours}}
% \hfil
% \subfloat[]{\includegraphics[width=1.2in]{Figures/gac/dcm_out.eps}%
% \label{fig:aorta_binary_thresholding}}
% \caption[水平集演进过程]{水平集演进过程：(a) 阈值滤波（$\text{TH}_{\text{lower}} = 300\text{HU}$, $\text{TH}_{\text{upper}} = 2000\text{HU}$）；(b) 从某一种子点开始，利用快速行进法进行的初始水平集演进；(c) 利用测地活动轮廓进行边缘检测（迭代次数: $100$）；(d) 利用二值阈值滤波完成像素亮度的反转（明亮区域的亮度值: $255$, 黑暗区域的亮度值: $0$）。}%
% \label{fig:aorta_level_set_evolution}
% \end{figure*}

\subsubsection{初始水平集演进}
\label{subsec:aorta_level_set}

生成初始水平集的计算与上述计算同时进行，其目的是为测地活动轮廓的演进提供每一步的形状提示。
在这一过程当中，我们首先引入了阈值计算（式(\ref{eqn:imaging_threshold})）来滤去输入图像（原始图像）当中的与本步骤无关的内容细节，例如：肝脏，双肾，肠道，胃，等等（见图\ref{fig:aorta_threholding}）。
这里，阈值的上下界分别设置为$300\text{HU}$\footnote{HU，即Hounsfield unit，为CT等影像模态的亮度单位，详见：\url{http://en.wikipedia.org/wiki/Hounsfield_scale}}和$2000\text{HU}$。
这个处理能够进一步降低计算任务对内存的占用，同时能够明显地缩短计算时间。
随后，我们引入了快速行进法来生成初始的传播界面。
我们制定了位于主动脉内部的一点作为种子点。
计算过程中，在图像中的某一点，将计算式(\ref{eqn:imaging_curves})中界面到达该点的时刻$T(x,y)$（见图\ref{fig:aorta_Fast_Marching}）。
注意到主动脉所具有的细长的几何特征，以及算法的特性，我们在对完整序列的实验中，沿着主动脉的中心线附近提供了一系列的种子点，这进一步缩短了计算时间，同时获得了更好的计算结果。

\subsection{GAC水平集演进}
\label{subsec:aorta_level_set}

测地活动轮廓的演进以特征图像和输入水平集为初始信息，由式(\ref{eqn:aorta_geodesic_3})所驱动。
由图\ref{fig:aorta_geodesic_active_contours}可以看到，这一演进过程一直进行，直到轮廓到达目标物体的边缘。
随后，我们引入二值阈值滤波（式(\ref{eqn:imaging_binary})），将最终轮廓的“内部”转换为高亮度区域，而轮廓的“外部”则转换为低亮度区域，以便随后的等值面提取（见图\ref{fig:aorta_binary_thresholding}）。
这里，所有通过本实验手动选定的各个参数均可以直接应用于三维（即完整序列）的情形。
\begin{figure*}[t]
\centering
\subfloat[]{\includegraphics[width=1.2in]{Figures/gac/dcm_threshold.eps}%
\label{fig:aorta_threholding}}
\hfil
\subfloat[]{\includegraphics[width=1.2in]{Figures/gac/dcm_fastMarching.eps}%
\label{fig:aorta_Fast_Marching}}
\hfil
\subfloat[]{\includegraphics[width=1.2in]{Figures/gac/dcm_geodesic.eps}%
\label{fig:aorta_geodesic_active_contours}}
\hfil
\subfloat[]{\includegraphics[width=1.2in]{Figures/gac/dcm_out.eps}%
\label{fig:aorta_binary_thresholding}}
\caption[水平集演进过程]{水平集演进过程：(a) 阈值滤波（$\text{TH}_{\text{lower}} = 300\text{HU}$, $\text{TH}_{\text{upper}} = 2000\text{HU}$）；(b) 从某一种子点开始，利用快速行进法进行的初始水平集演进；(c) 利用测地活动轮廓进行边缘检测（迭代次数: $100$）；(d) 利用二值阈值滤波完成像素亮度的反转（明亮区域的亮度值: $255$, 黑暗区域的亮度值: $0$）。}%
\label{fig:aorta_level_set_evolution}
\end{figure*}

\subsection{分割结果评估}
\label{subsec:aorta_evaluation}

在本章中，我们所提出的方法的准确性将通过Jaccard指数\cite{Jaccard1912}和Dice指数\cite{Zijdenbos1994}进行评估。
现假设评估目标图像$T$对于源图像$S$的准确性，记$i$为两图像中各个标签（即：欲分割或探测的目标）。
那么Jaccard指数$J$则可以表示为：
\begin{equation}
\label{eqn:aorta_Jaccard}
J = \frac{\sum_i | S_i \bigcap T_i |}{\sum_i | S_i \bigcup T_i |},
\end{equation}

\begin{table}[t]
\renewcommand{\arraystretch}{0.5}
\caption[主动脉内腔分割结果评估]{主动脉内腔表面模型分割结果评估}
\label{tbl:aorta_evaluation}
\centering
\begin{tabular*}{75mm}{c c c}
\toprule
\hspace{2mm} \small{数据集序号}  & \hspace{2mm} \small{Jaccard}    & \hspace{2mm} \small{Dice}       \\
\midrule
\hspace{2mm} \small{1}           & \hspace{2mm} \small{$0.936434$} & \hspace{2mm} \small{$0.967174$} \\
\midrule
\hspace{2mm} \small{2}           & \hspace{2mm} \small{$0.928468$} & \hspace{2mm} \small{$0.962907$} \\
\midrule
\hspace{2mm} \small{3}           & \hspace{2mm} \small{$0.911307$} & \hspace{2mm} \small{$0.953595$} \\
\midrule
\hspace{2mm} \small{4}           & \hspace{2mm} \small{$0.918612$} & \hspace{2mm} \small{$0.95758$} \\
\midrule
\hspace{2mm} \small{5}           & \hspace{2mm} \small{$0.893099$} & \hspace{2mm} \small{$0.943531$} \\
\midrule
\hspace{2mm} \small{6}           & \hspace{2mm} \small{$0.953753$} & \hspace{2mm} \small{$0.976329$} \\
\midrule
\hspace{2mm} \small{7}           & \hspace{2mm} \small{$0.983812$} & \hspace{2mm} \small{$0.99184$} \\
\midrule
\hspace{2mm} \small{8}           & \hspace{2mm} \small{$0.922035$} & \hspace{2mm} \small{$0.959436$} \\
\midrule
\hspace{2mm} \small{9}           & \hspace{2mm} \small{$0.928791$} & \hspace{2mm} \small{$0.963081$} \\
\midrule
\hspace{2mm} \small{10}          & \hspace{2mm} \small{$0.937794$} & \hspace{2mm} \small{$0.967899$} \\
\midrule
\hspace{2mm} \small{11}          & \hspace{2mm} \small{$0.950207$} & \hspace{2mm} \small{$0.974468$} \\
\bottomrule
\end{tabular*}
\end{table}
\begin{figure}[H]
\centering
\subfloat[]{\includegraphics[width=3.0in,height=1.98in]{Figures/gac/Jaccard.eps}%
\label{fig:aorta_Jaccard}}\\
\subfloat[]{\includegraphics[width=3.0in,height=1.98in]{Figures/gac/Dice.eps}%
\label{fig:aorta_Dice}}
\caption[主动脉内腔分割结果评估]{主动脉内腔分割结果评估: (a) 基于Jaccard系数；(b) 基于Dice系数。}%
\label{fig:aorta_evaluation}
\end{figure}
\noindent 其中， $S_i$表示源图像$S$中的第$i$个标签，$T_i$表示源图像$T$中的第$i$个标签，$| \cdot |$ 则表示以体素（或像素）来计算所得到的体积。
Jaccard指数又称为“并集重叠”，指目标图像与源图像的交集除以它们的并集。

\begin{figure}[t]
\centering
\includegraphics[height=3.5in]{Figures/gac/model.eps}
\caption[主动脉内腔三维模型]{主动脉内腔三维模型。}
\label{fig:aorta_visualization}
\end{figure}

Dice指数$D$可表示为：
\begin{equation}
\label{eqn:aorta_Dice}
D = 2 \frac{\sum_i | S_i \bigcap T_i |}{\sum_i ( | S_i | + | T_i |)}.
\end{equation}
它又称为“均值叠加”，指两区域相交部分除以此两区域的平均体积。
表\ref{tbl:aorta_evaluation}记录本章实验中的十一组数据集两项指数的评估结果。
图\ref{fig:aorta_evaluation}显示指数评估结果的柱状图。
其中，Jaccard指数的平均值为$0.933$，标准差为$0.0240$；Dice指数的平均值为$0.965$，标准差为$0.0128$。

\subsection{表面重建}
\label{subsec:aorta_experiments_isosurface}

最后，分割所得到的体数据信息将通过行进立方体方法\cite{Lorensen1987MC}进行处理，以获得目标的等值面信息。
等值面的值对应于主动脉内腔边缘的像素亮度值。
这里，之前的二值阈值滤波中的阈值上限被选为等值面的值。
这确保了随后所渲染的表面模型表示主动脉的内腔表面。
最终的可视化模型如图\ref{fig:aorta_visualization}所示。
