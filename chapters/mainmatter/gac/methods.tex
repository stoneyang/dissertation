
\section{基于GAC的分割处理流程设计}
\label{sec:gac_pipeline}

\subsection{分割管线的设计}

正如上节所述，本章工作的目的在于设计图像分割的处理流程。
使之能够很好地利用GAC的特性，从而获得相应解剖结构的表面模型。

分割主动脉内腔的完整处理流程的设计如图\ref{fig:aorta_data_flow}所示。
原始医学图像进行数据格式的转换之后，将作为同时开始的两项不同计算任务的输入：一项用于计算并生成边缘势场（即：特征图像），另一项用于生成距离图（即：初始水平集）。
这两项计算完成后，其结果即作为主动脉内腔分割的核心环节的输入数据，为该环节提供演进计算的参考。
最后，分割所得结果（即：主动脉内腔的边缘）经过亮度的反转变换，再利用行进立方体方法提取其等值面，最终通过表面渲染技术获得主动脉内腔模型的立体可视效果。
\begin{figure}[t]
\centering
\input{FigureSrc/gac/data_flow}
% \includegraphics[width=3.2in]{Figures/gac/DataFlow.eps}
\caption[主动脉内腔分割流程]{主动脉内腔分割流程。}
\label{fig:aorta_data_flow}
\end{figure}

心脏近似区域的分割流程由上述工作改进而来，主要是针对分割流程中预处理环节进行了调整，该方法完整的流程如图\ref{fig:heart_data_flow}所示。
首先，我们从原始影像数据中选取心脏所在区域，然后进行对该区域平滑处理。
随后，将平滑处理后的影像数据通过阈值滤波转换为边缘保持较完整的二值图像。
第三，同时计算二值图像的特征图像和输入水平集。
第四，利用活动轮廓方法获得心脏区域的边界。
最后，对心脏表面模型进行可视化。
\begin{figure}[ht]
\centering
\input{FigureSrc/gac/heart/data_flow}
% \includegraphics[height=2.0in]{figures/heart/DataFlow.eps}
\caption[心脏近似区域分割流程]{心脏近似区域分割流程。}
\label{fig:heart_data_flow}
\end{figure}

\subsection{测地活动轮廓}
\label{sec:aorta_gac}

测地活动轮廓方法是一种用于物体边缘探测的图像处理方法，它根植于“蛇”模型，是一种对该模型的改进。
经典的“蛇”或活动轮廓模型最早由Kass等人提出，该方法主要用于图像中的物体边缘的探测\cite{Kass1988}。
其主导思想是通过演进一个轮廓（或“围线”）$\mathcal{C}$，以检测得出目标物体的边缘信息。
这一演进过程实际上是通过使一个能量泛函$E$的最小化来实现的，取得这个（局部）最小值的位置恰好是目标物体的边缘。
然而，该方法中的轮廓是无法控制其自身的拓扑的。
这时，若无额外的处理，该方法则无法完成同时探测多个目标的任务\cite{Caselles1997}。

Caselles等人改进了经典的“蛇”模型――提出了测地活动轮廓方法，该方法允许围线同时探测图像中的多个目标的内部边缘和外部边缘\cite{Caselles1997}。
这一方法引入了测地学计算和水平集演进的概念，其数学模型事实上是经典模型的一个特例：
\begin{equation}
\label{eqn:aorta_particular_snakes}
E(\mathcal{C}) = \alpha \int_0^1 | \mathcal{C}'(q) |^2 dq - \lambda \int_0^1 | \nabla I_{s} ( \mathcal{C}(q) ) |dq,
\end{equation}
其中，$\mathcal{C}(\cdot)$表示参数化的平面内曲线$\mathcal{C}(q):[0,1]\rightarrow \mathrm{R}^2$，
$I_{s}:[0,a]\times [0,b]\rightarrow \mathrm{R}^{+}$代表含有待探测目标物体的图像，
$\alpha$是传导常数，控制轮廓本身的粗细，
$\lambda$是曲率常数。

为最小化式(\ref{eqn:aorta_particular_snakes})所定义的泛函，通过取得最大值的点$|\nabla I_{s}|$的曲线的位置必须确定。
在这一过程中，还必须保持该曲线的某种程度的平滑性。
在式(\ref{eqn:aorta_particular_snakes})中，$|\nabla I_{s}|$可以由$-g(|\nabla I_{s}|)$所替换，其中$g(\cdot): [0, \infty) \rightarrow \mathrm{R}^{+}$是一个单调递减函数。
由此可以得到如下的能量泛函：
\begin{equation}
\label{eqn:aorta_general_energy}
E(\mathcal{C}) = \alpha \int_0^1 | \mathcal{C}'(q) |^2 dq + \lambda \int_0^1 g( | \nabla I_{s} ( \mathcal{C}(q) ) | )^2 dq.
\end{equation}

光在某不均与介值中的传播必然不会保持“直线”，其传播路径的弧长可由下式计算得出：
\begin{equation}
\label{eqn:Fermat}
L_{R} = \int_{A}^{B} n(s) ds,
\end{equation}
其中，
$L_{R}$表示光线在介质中的传播路径的弧长，
$A$，$B$表示传播路径的起点和终点，
$n(\cdot)$表示介值的折射率。
由光学中的Fermat原理可知，路径$L_{R}$通过的路径将由最短光程所确定。
也就是说，所确定的路径将使式(\ref{eqn:Fermat})达到最小。
而该思路与GAC模型的演进目的相类似。
于是，仿照Fermat原理，上述围线演进的目的就是为了获得
\begin{equation}
\label{eqn:aorta_min_model}
\min \int_0^1 g(|\nabla I_{s} ( \mathcal{C} (q) )|) |\mathcal{C}' (q)| dq.
\end{equation}
在式(\ref{eqn:aorta_general_energy})中，$g(\cdot)$等同于曲线演进的速度。
而且它也依赖图像细节的几何性质。
为了获得理想的目标物体的边缘探测结果，参数$g(\cdot)$的选择是独立于测地计算的。
因此，式(\ref{eqn:aorta_min_model})所表示的最小值可以重新表示为：
\begin{equation}
\label{eqn:aorta_min_model_2}
\min \int_0^1 g(I_{\sigma}) |\mathcal{C}' (q)| dq,
\end{equation}
其中，$I_{\sigma}$表示输入的特征图像（生成过程见第\ref{subsec:aorta_feature_image}节）。
为了获得式(\ref{eqn:aorta_min_model_2})所表示的最小值，需要计算该模型的Euler-Lagrange方程：
\begin{equation}
\label{eqn:aorta_evolution_model}
\frac{\partial \mathcal{C}(t)}{\partial t} = g(I_{\sigma}) \kappa \mathcal{N} - (\nabla g(I_{\sigma}) \cdot \mathcal{N}) \mathcal{N},
\end{equation}
其中$\kappa$表示曲线$\mathcal{C}(t)$的曲率，$\mathcal{N}$是指向“内部”的单位法向量。
该方程刻画了曲线$\mathcal{C}$向欲探测的目标物体不断演进的过程。
初始曲线为$\mathcal{C}(0) = \mathcal{C}_0$，它的演进目标就是式(\ref{eqn:aorta_min_model_2})所表示的（局部）最小值。

根据式(\ref{eqn:aorta_evolution_model})，该演进过程将会在$\frac{\partial \mathcal{C}(t)}{\partial t} = 0$时停止，这意味着目标物体的边缘被成功探知。
假设曲线$\mathcal{C}$是一个函数的水平集$u(\cdot):[0,a] \times [0,b] \rightarrow \mathrm{R}$。
考虑式(\ref{eqn:aorta_min_model_2})和式(\ref{eqn:aorta_evolution_model})，之前的测地计算即可转换为寻找如下方程的稳态解：
\begin{equation}
\label{eqn:aorta_level_set_model}
\begin{split}
\frac{\partial u}{\partial t} & = |\nabla u| \textrm{div} \left(g(I_{\sigma}) \frac{\nabla u}{|\nabla u|}\right) \\
                              %& = g(I_{\sigma}) |\nabla u| \textrm{div} \left(\frac{\nabla u}{|\nabla u|}\right) + \nabla g(I_{\sigma}) \cdot \nabla u \\
                              & = g(I_{\sigma}) |\nabla u| \kappa + \nabla g(I_{\sigma}) \cdot \nabla u,
\end{split}
\end{equation}
其中，$\kappa = \textrm{div}\left(\frac{\nabla u}{|\nabla u|}\right)$。
该方程的等号右侧即为式(\ref{eqn:aorta_min_model_2})中的Euler-Lagrange方程。

为了增加作用于围线的“吸引力”（该吸引力将围线向着目标物体的边缘吸引），并且允许探测非凸性目标物体，向式(\ref{eqn:aorta_level_set_model})中引入$cg(I_{\sigma})|\nabla u|$，可得:
\begin{equation}
\label{eqn:aorta_geodesic_1}
\frac{\partial u}{\partial t} = |\nabla u| \textrm{div} \left(g(I_{\sigma}) \frac{\nabla u}{|\nabla u|}\right) + c g(I_{\sigma}) |\nabla u|,
\end{equation}
其中，$c$为一常量，满足$c \in \mathrm{R}^+$。
考虑式(\ref{eqn:aorta_level_set_model})，上述方程又可以表示为：
\begin{equation}
\label{eqn:aorta_geodesic_2}
\frac{\partial u}{\partial t} = g( I_{\sigma} )( c + \kappa ) |\nabla u| + \nabla u \cdot \nabla g(I_{\sigma}).
\end{equation}
此方程可以转换为下面的方程：
\begin{equation}
\label{eqn:aorta_geodesic_3}
\frac{\partial \mathcal{C}}{\partial t} = g(I_{\sigma}) ( c + \kappa ) \mathcal{N} - ( \nabla g(I_{\sigma}) \cdot \mathcal{N} ) \mathcal{N}.
\end{equation}
这里，探测目标物体边缘的问题的解就等价于式(\ref{eqn:aorta_geodesic_1})的稳态（$u_t = 0$）的零水平集。
曲线演化时受到了两种“力”的作用：第一种是“内力”，对应于式(\ref{eqn:aorta_geodesic_3})中的第一项，它来自于围线自身几何形变（即曲率运动）；第二种是“外力”，对应于式(\ref{eqn:aorta_geodesic_3})中的第二项，使围线向边界移动。

