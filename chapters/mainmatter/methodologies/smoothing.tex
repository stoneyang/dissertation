\section{多边形表面的平整}
\label{sec:visualization_smoothing}

在计算机图形学和图像处理领域，二维或三维的曲线和表面（两者都可看作是“形状”）的可视化是普遍的，尤其对于医学领域的体数据而言。
这类计算实际上是利用分段的曲线或者多边形表面来近似地估计原始的形状。
典型的实例是图\ref{fig:visualization_artifact}所展示的表面上某种程度的衍生物（artifact），它在可视化过程中产生，能够在保持表面模型整体几何特性不发生改变的前提下被“打磨”平整（见图\ref{fig:visualization_artifact_removed}）。
在本文中，我们在医学数据可视化方面工作的目标之一便是对由原始医学体数据处理而得到的模型的表面进行平整处理。
\begin{figure}[t]
\centering
\subfloat[]{\includegraphics[height=1.5in]{figures/methodologies/artifact.eps}%
\label{fig:visualization_artifact}}
\hfil
\subfloat[]{\includegraphics[height=1.5in]{figures/methodologies/artifact_removed.eps}%
\label{fig:visualization_artifact_removed}}
\caption[曲面平整处理]{曲面平整处理。(a) 不平整区域（血管模型表面上水平方向的“台阶”）；(b) 平滑处理后的该区域。}%
\label{fig:visualization_artifact_comparison}
\end{figure}
为实现这一目标，我们引入一种基于windowed sinc函数\footnote{详见：\url{http://www.cg.tuwien.ac.at/~theussl/DA/node34.html}}的信号处理方法，该方法实际上是一种线性低通滤波器\cite{Taubin1995ICCV}，属于数字信号处理领域中的一种低层处理技术。
它能够应用于对几何上任意维度和复杂程度的曲线或者曲面进行平整处理，并且在此计算过程并不会引起模型的收缩。
该方法建立在“离散图信号”概念，及其三维的情形“离散表面信号”的基础之上\cite{Taubin1995SIG}。

所谓“离散图信号”，指的是某定义在离散图（有些文献中简称“digraph”）上的函数。
与我们所考虑的多边形曲面所对应的是，离散图$G$可以记为：$G: \left\{ V_g, E\right\}$，其中，$V_g = \left\{ 1, \ldots, n \right\}$是顶点的集合，它包含图中的所有顶点，记号从$1$到$n$；而$E$是边的集合，它包含顶点集合$V_g$中任意一对顶点之间边。
所谓的“离散图信号”是一个$n$维向量$x = \left[ x_1, \ldots, x_n \right]^T$，该向量的各分量$x_i$，$i = 1, \ldots, n$表示顶点$i \in V_g$处的信号强度。

所谓“离散表面信号”，指的是某定义在多边形曲面上的函数。
多边形曲面$S$可表示为$S: \left\{ V_s, F\right\}$，其中，$V_s = \left\{ 1, \ldots, n \right\}$是顶点的集合，它包含多边形曲面中的所有顶点，记号从$1$到$n$；而$F$是面的集合，它包含顶点集合$V_s$中任意顶点以及它们之间的边所围成的面。
离散表面信号也是一个$n$维向量$y = \left[ y_1, \ldots, y_n \right]^T$，该向量的各分量$y_j$，$j = 1, \ldots, n$表示顶点$j \in V_s$处的信号强度。

对平面内分段式曲线的平整，我们可应用经典的Fourier分析将原始曲线根据不同的频率分解到正交子空间中去。
然后，将高频分量看做噪声而除去，并将低频分量保留。
这个想法可以推广至具有任意拓扑的多边形曲面的情形。

对于离散表面信号$y$，$V_s$中的顶点处的加权Laplacian算子定义如下：
\begin{equation}
\label{eqn:visualization_laplacian}
\Delta y_i = \sum_{j \in i^{\ast}} w_{ij} \left( y_j - y_i \right),
\end{equation}
其中，$w_{ij}$是$y_j - y_i$的正的加权值，而对任意$i$，其加权值之和为$1$，即：$\sum_{j \in i^{\ast}} w_{ij} = 1$。
式(\ref{eqn:visualization_laplacian})写成矩阵形式如下：
\begin{equation}
\label{eqn:visualization_laplacian_matrix}
\Delta y = - K y,
\end{equation}
其中，$K = I - W$，$W$是加权阵，$I$是单位阵。
这里，我们定义$0 \leq \lambda_1 \leq \ldots \leq \lambda_n \leq 2$为$K$阵的实特征值，它们对应的右特征向量则是$e_1, \ldots, e_n$。

至此，低通滤波就被转化为矩阵函数$f(K)$与输入信号$y$的乘积：
\begin{equation}
\label{eqn:visualization_low_pass_equivalent}
y' = f(K) y.
\end{equation}
对任意多项式传递函数，式(\ref{eqn:visualization_low_pass_equivalent})中的输出函数可以重写为：
\begin{equation}
\label{eqn:visualization_low_pass_polynomial}
y' = \sum_{i=1}^{n} \rho_i f(k_i) e_i,
\end{equation}
其中，$\rho_i$是输入信号$y$的单位右特征向量的线性组合的系数，即：$y = \sum_{i} \rho_i e_i$。
为实现此低通滤波器，$f(k_i)$需要满足两个条件：对低频情况，$k_i \in [0,2]$，$f(k_i) \approx 1$；对高频情况：$f(k_i) \approx 0$。

低通滤波的机制可通过调整如下多项式估计中的权值来实现\cite{Taubin1996}：
\begin{equation}
\label{eqn:visualization_approximation}
f_{N}(k) = w_0 \frac{\theta}{\pi} T_0 (1 - k / 2) + w_n \sum_{n} \frac{2 \sin (n \theta)}{n \pi} T_n(1 - k / 2),
\end{equation}
其中，$\theta$是$k = 2 (1 - \cos \theta)$在$[0, \pi / 2]$上的唯一解，而$T_0(\cdot)$和$T_n(\cdot)$则是Chebyshev多项式。
在本章中，我们通过调整式(\ref{eqn:visualization_approximation})中的权值来形成Hamming窗\cite{Taubin1996}：
\begin{equation}
\label{eqn:visualization_hamming}
w_n = 0.54 + 0.46 \cos (n \pi / (N + 1) ).
\end{equation}

在完成曲面的平整处理之后，我们需要为各个多边形网格计算法向量，以便标注表面的“内部”和“外部”。