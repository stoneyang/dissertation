
\section{方法}
\label{sec:coronary_enhanced_intro}

本节讨论分割流程的设计，并详细介绍各个环节的原理。
图\ref{fig:coronary_enhanced_data_flow}宏观地展示了处理流程的方框图。
首先，原始数据中像素的数据类型被转换，以便进行后续的增强计算。
然后，我们利用设定恰当的阈值的阈值滤波器滤去了多数与本章工作无关的图像内容。
随后，我们引入了图像增强环节对图像中的目标管状物体进行增强。
接着，对增强后的图像进行两个并列进行的计算，以生成特征图像和输入水平集。
此后，我们利用改进的测地学活动轮廓模型进行演进，从而获得图像中微小而复杂的冠状动脉的边缘信息。
最后，血管的边缘被提取并通过面渲染的方式显示。
\begin{figure}[t]
\centering
\includegraphics[height=3.2in,width=3.2in]{figures/coronary_enhanced/DataFlow.eps}
\caption{冠状动脉分割流程。}
\label{fig:coronary_enhanced_data_flow}
\end{figure}

\subsection{管状物体的增强}
\label{subsec:coronary_enhanced_tubular}

管状物体增强是一种多尺度的线滤波，这种策略可以总结为：突出图像中的“管状”目标，同时抑制其余的图像内容。
为了实现这一策略，本文引入了Sato等人\cite{Sato1998}提出的三维多尺度算法。

欲将滤波器的响应整形为某特定宽度的线形并抑制噪声的影响，就需要对像素与Gaussian核的二阶导数进行卷积运算。
这一计算等价与计算三维图像$I(\cdot)$的Hessian矩阵$\mathcal{H}$：
\begin{gather}
\label{eqn:coronary_enhanced_Hessian}
\mathcal{H} = \nabla^2 I =
\begin{bmatrix}
I_{xx} & I_{xy} & I_{xz} \\ I_{yx} & I_{yy} & I_{yz} \\ I_{zx} & I_{zy} & I_{zz}
\end{bmatrix},
\end{gather}
其中，$I_{xx} = \frac{\partial^2 I}{\partial^2 x}$，$I_{xy} = \frac{\partial^2 I}{\partial x \partial y}$，以此类推。
而且，所有这些二阶偏导数都是与Gaussian核$G(x; \sigma)$进行卷积的结果，此处，Gaussian核的标准差为$\sigma$：
\begin{equation}
\label{eqn:coronary_enhanced_gaussian_convolution}
I_{xx} = I \ast \frac{\partial^2 G}{\partial^2 x}.
\end{equation}
式(\ref{eqn:coronary_enhanced_Hessian})的特征值为：$\lambda_1$，$\lambda_2$，$\lambda_3$，$\lambda_1 > \lambda_2 > \lambda_3$；
与之相对应的特征向量分别是：$e_1$，$e_2$，$e_3$。

当$\lambda_1 \approx 0$ and $\lambda_2 \approx \lambda_3 \ll 0$时，线测度（line measure）可以表示为：
\begin{equation}
\label{eqn:coronary_enhanced_line_measure}
\lambda_{123} =
\begin{cases}
\left| \lambda_3 \right| \left( \frac{\lambda_2}{\lambda_3} \right)^{\gamma_{23}} \left( 1 + \frac{\lambda_1}{\left| \lambda_2 \right|} \right)^{\gamma_{12}}, & \lambda_1 \le 0 \\
\left| \lambda_3 \right| \left( \frac{\lambda_2}{\lambda_3} \right)^{\gamma_{23}} \left( 1 - \alpha \frac{\lambda_1}{\left| \lambda_2 \right|} \right)^{\gamma_{12}}, & \frac{\left| \lambda_2 \right|}{\alpha} > \lambda_1 > 0 \\
0, & \text{其它}.
\end{cases}
\end{equation}
在式(\ref{eqn:coronary_enhanced_line_measure})中，
额外的参数$\gamma_{12}$，$\gamma_{23}$，以及$\alpha$均为正的常量，
其中，
$\gamma_{12} \in [0, \infty)$用于分辨分支状结构和噪声，以及伪分支，
$\gamma_{23} \in [0, \infty)$控制锐度，
对于任意$\lambda_1$，$\alpha \in (0, 1.0]$保持函数中最后一项对称性。

此外，具有不同的特征值的线形滤波器能够用于增强不同形状的目标物体（见表\ref{tbl:coronary_enhanced_eigenvalues}）。
\begin{table}
\renewcommand{\arraystretch}{0.5}
\caption{增强不同形状所需的特征值}
\label{tbl:coronary_enhanced_eigenvalues}
\centering
\begin{tabular*}{100mm}{cc}
\toprule
\hspace{10mm} \bfseries \small{物体形状}  & \hspace{15mm}                    \bfseries \small{特征值}                       \\
\midrule                                 
\hspace{10mm} \small{明亮的管状}          & \hspace{15mm}  \small{$\lambda_1 \approx 0, \lambda_2 \approx \lambda_3 \ll 0$} \\
\hspace{10mm} \small{暗淡的管状}          & \hspace{15mm}  \small{$\lambda_1 \approx 0, \lambda_2 \approx \lambda_3 \gg 0$} \\
\hspace{10mm} \small{明亮的盘状}          & \hspace{15mm}  \small{$\lambda_1 \approx \lambda_2 \approx 0, \lambda_3 \ll 0$} \\
\hspace{10mm} \small{暗淡的盘状}          & \hspace{15mm}  \small{$\lambda_1 \approx \lambda_2 \approx 0, \lambda_3 \gg 0$} \\
\hspace{10mm} \small{明亮的球状}          & \hspace{15mm}  \small{$\lambda_1 \approx \lambda_2 \approx \lambda_3 \ll 0$}    \\
\hspace{10mm} \small{暗淡的球状}          & \hspace{15mm}  \small{$\lambda_1 \approx \lambda_2 \approx \lambda_3 \gg 0$}    \\
\bottomrule
\end{tabular*}
% \caption{增强不同形状所需的特征值}
\end{table}

\subsection{水平集演进之前的预处理}
\label{subsec:coronary_enhanced_preprocessing}

\subsubsection{特征图像的计算}
\label{subsubsec:coronary_enhanced_feature_image}

水平集算法驱动围线在梯度场中演进。
在这种梯度场中，像素的亮度在目标物体的边缘处发生“尖锐的”变化。
特征图像的目的就是提供一幅形状完好的梯度场。
在获得梯度场的过程中，我们首先计算各个像素处的梯度的幅值。
然后，梯度图像$I_{\nabla}$被转换为特征图像$I_{\sigma}$，这一转换通过应用S型函数来完成:
\begin{equation}
\label{eqn:coronary_enhanced_sigmoid}
I_{\sigma} = (I_{max} - I_{min}) \cdot \frac{1}{1 + \exp\left(-\frac{I_{\nabla} - n}{m}\right)} + I_{min},
\end{equation}
其中，
$I_{max}$与$I_{min}$分别表示输出亮度的最值，
$m$是一个常量，它控制输入像素亮度的的窗口宽度，
$n$则是一个确定该窗口中心位置的常量。

\subsubsection{一种改进的Fast Marching方法}

波面碰撞（colliding fronts）――一种改进的快速行进法，其目的是为后续的分割工作生成输入水平集。
这种方法的实现建立在经典的快速行进法\cite{Sethian1999}的基础上。
与经典方法不同的是，在同一轮计算中，我们可以同时为其提供两个种子点，两个种子点就意味着两个波面同时传播，直到它们相互“碰撞”为止。
这样，我们就可以较快地获得水平集结果。

\subsection{CURVES演进模型}

在本章中，我们引入了CURVES方法\cite{Lorigo2001}来对结构复杂的冠状动脉进行分割。
该方法在分割立体医学数据中的复杂线状结构十分有效。
此外，CURVES方法的准则还考虑到了欲分割目标边缘的局部平滑性。

该方法是对Caselles等人\cite{Caselles1997}所提出的测地学活动轮廓的一项改进。
作为测地学活动轮廓的扩展研究，CURVES是一种水平集算法，它将细微的血管抽象为具有任意复杂度的拓扑结构的空间曲线\cite{Lorigo2001}。
CURVES将水平集演进到目标物体的边缘，这一过程基于如下能量泛函的最小化：
\begin{equation}
\label{eqn:coronary_enhanced_CURVES}
\oint_0^1 g\left( \left| \nabla I \left( \mathcal{C} \left(  s \right) \right) \right| \right) \left| \mathcal{C}'\left( s \right) \right| ds,
\end{equation}
其中，
$\mathcal{C}\left( s \right): [0,1] \rightarrow \mathrm{R}^3$是一个一维曲线，
$I\left( \cdot \right): [0, a] \times [0, b] \times [0, c] \rightarrow [0, \infty)$是曲线演进所在的图像，
$g\left( \cdot \right): [0, \infty) \rightarrow \mathrm{R}^+$则是一个单调递减函数。

该泛函的最小化可以通过搜索泛函自身的梯度下降方向来实现。
也就是说，需要计算与式(\ref{eqn:coronary_enhanced_CURVES})相关的Euler-Lagrange方程。
于是，我们可以得到如下的测地流方程，该方程控制围线在这一过程当中的演进：
\begin{equation}
\label{eqn:coronary_enhanced_evolution}
\frac{\partial \mathcal{C}}{\partial t} = k \mathcal{N} - \frac{g'}{g} \varPi \left( \mathcal{H} \frac{\nabla I}{ \left| \nabla I \right| } \right),
\end{equation}
其中，
$\mathcal{H}$是图像$I$的Hessian矩阵，
$k$是欧式曲率，
$\mathcal{N}$单位法向量，
$\varPi(\cdot)$是投影算子，它将一个参数投影至正则空间。
据此，我们可以得到更新方程：
\begin{equation}
\label{eqn:coronary_enhanced_update}
\frac{\partial v}{\partial t} = \mathcal{F} \left( \nabla v(x, t), \nabla^2 v(x, t) \right) + \frac{g'}{g} \nabla v(x, t) \mathcal{H} \frac{\nabla I}{ \left| \nabla I \right| },
\end{equation}
其中，$v(\cdot): \mathrm{R}^3 \rightarrow [0, \infty)$是曲线$\mathcal{C}$的嵌入函数，
$\mathcal{F} \left( \nabla v(x, t), \nabla^2 v(x, t) \right)$是矩阵$P_{\nabla v} \nabla^2 v P_{\nabla v}$较小的特征值。
矩阵$P_q$可定义为一个投影算子，它能将某向量投影到向量$q \in \mathrm{R}^3$张成的正则空间：
\begin{equation}
\label{eqn:coronary_enhanced_projection_operator}
P_q = I_0 - \frac{qq^T}{\left| q \right|^2},
\end{equation}
其中，$I_0$代表单位矩阵。

通过向演进方程(\ref{eqn:coronary_enhanced_evolution})中引入特征图像$I_{\sigma}$，这种情形的演进可以表示成：
\begin{equation}
\label{eqn:coronary_enhanced_application}
\frac{\partial \mathcal{C}}{\partial t} = k \mathcal{N} - \frac{g'(I_{\sigma})}{g(I_{\sigma})} \varPi \left( \mathcal{H} \frac{\nabla I_{\sigma}}{ \left| \nabla I_{\sigma} \right| } \right).%
\end{equation}

\subsection{等值面渲染}

用于可视化的表面信息通过行进立方体方法\cite{Lorensen1987MC}来获得。
