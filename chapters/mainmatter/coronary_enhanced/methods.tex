
\section{方法}
\label{sec:coronary_enhanced_methods}

本节讨论分割流程的设计，并详细介绍各个环节的原理。
图\ref{fig:coronary_enhanced_data_flow}宏观地展示了处理流程的方框图。
首先，原始数据中像素的数据类型被转换，以便进行后续的增强计算。
然后，我们利用设定恰当的阈值的阈值滤波器滤去了多数与本章工作无关的图像内容。
随后，我们引入了图像增强环节对图像中的目标管状物体进行增强。
接着，对增强后的图像进行两个并列进行的计算，以生成特征图像和输入水平集。
此后，我们利用改进的测地学活动轮廓模型进行演进，从而获得图像中微小而复杂的冠状动脉的边缘信息。
最后，血管的边缘被提取并通过面渲染的方式显示。
\begin{figure}[t]
\centering
\includegraphics[height=3.2in,width=3.2in]{figures/coronary_enhanced/DataFlow.eps}
\caption{改进的冠状动脉分割流程。}
\label{fig:coronary_enhanced_data_flow}
\end{figure}

\subsection{管状物体的增强}
\label{subsec:coronary_enhanced_tubular}

管状物体增强是一种多尺度的线滤波，这种策略可以总结为：突出图像中的“管状”目标，同时抑制其余的图像内容。
为了实现这一策略，本文引入了Sato等人\cite{Sato1998}提出的三维多尺度算法。

欲将滤波器的响应整形为某特定宽度的线形并抑制噪声的影响，就需要对像素与Gaussian核的二阶导数进行卷积运算。
这一计算等价与计算三维图像$I(\cdot)$的Hessian矩阵$\mathcal{H}$：
\begin{gather}
\label{eqn:coronary_enhanced_Hessian}
\mathcal{H} = \nabla^2 I =
\begin{bmatrix}
I_{xx} & I_{xy} & I_{xz} \\ I_{yx} & I_{yy} & I_{yz} \\ I_{zx} & I_{zy} & I_{zz}
\end{bmatrix},
\end{gather}
其中，$I_{xx} = \frac{\partial^2 I}{\partial^2 x}$，$I_{xy} = \frac{\partial^2 I}{\partial x \partial y}$，以此类推。
而且，所有这些二阶偏导数都是与Gaussian核$G(x; \sigma)$进行卷积的结果，此处，Gaussian核的标准差为$\sigma$：
\begin{equation}
\label{eqn:coronary_enhanced_gaussian_convolution}
I_{xx} = I \ast \frac{\partial^2 G}{\partial^2 x}
\end{equation}
式(\ref{eqn:coronary_enhanced_Hessian})的特征值为：$\lambda_1$，$\lambda_2$，$\lambda_3$，$\lambda_1 > \lambda_2 > \lambda_3$；
与之相对应的特征向量分别是：$e_1$，$e_2$，$e_3$。

当$\lambda_1 \approx 0$ and $\lambda_2 \approx \lambda_3 \ll 0$时，线测度（line measure）可以表示为：
\begin{equation}
\label{eqn:coronary_enhanced_line_measure}
\lambda_{123} =
\begin{cases}
\left| \lambda_3 \right| \left( \frac{\lambda_2}{\lambda_3} \right)^{\gamma_{23}} \left( 1 + \frac{\lambda_1}{\left| \lambda_2 \right|} \right)^{\gamma_{12}}, & \lambda_1 \le 0 \\
\left| \lambda_3 \right| \left( \frac{\lambda_2}{\lambda_3} \right)^{\gamma_{23}} \left( 1 - \alpha \frac{\lambda_1}{\left| \lambda_2 \right|} \right)^{\gamma_{12}}, & \frac{\left| \lambda_2 \right|}{\alpha} > \lambda_1 > 0 \\
0, & \text{其它}.
\end{cases}
\end{equation}
在式(\ref{eqn:coronary_enhanced_line_measure})中，
额外的参数$\gamma_{12}$，$\gamma_{23}$，以及$\alpha$均为正的常量，
其中，
$\gamma_{12} \in [0, \infty)$用于分辨分支状结构和噪声，以及伪分支，
$\gamma_{23} \in [0, \infty)$控制锐度，
对于任意$\lambda_1$，$\alpha \in (0, 1.0]$保持函数中最后一项对称性。

此外，具有不同的特征值的线形滤波器能够用于增强不同形状的目标物体（见表\ref{tbl:coronary_enhanced_eigenvalues}）。
\begin{table}
\renewcommand{\arraystretch}{0.5}
\caption{增强不同形状所需的特征值}
\label{tbl:coronary_enhanced_eigenvalues}
\centering
\begin{tabular*}{100mm}{cc}
\toprule
\hspace{10mm} \bfseries \small{物体形状}  & \hspace{15mm}                    \bfseries \small{特征值}                       \\
\midrule                                 
\hspace{10mm} \small{明亮的管状}          & \hspace{15mm}  \small{$\lambda_1 \approx 0, \lambda_2 \approx \lambda_3 \ll 0$} \\
\hspace{10mm} \small{暗淡的管状}          & \hspace{15mm}  \small{$\lambda_1 \approx 0, \lambda_2 \approx \lambda_3 \gg 0$} \\
\hspace{10mm} \small{明亮的盘状}          & \hspace{15mm}  \small{$\lambda_1 \approx \lambda_2 \approx 0, \lambda_3 \ll 0$} \\
\hspace{10mm} \small{暗淡的盘状}          & \hspace{15mm}  \small{$\lambda_1 \approx \lambda_2 \approx 0, \lambda_3 \gg 0$} \\
\hspace{10mm} \small{明亮的球状}          & \hspace{15mm}  \small{$\lambda_1 \approx \lambda_2 \approx \lambda_3 \ll 0$}    \\
\hspace{10mm} \small{暗淡的球状}          & \hspace{15mm}  \small{$\lambda_1 \approx \lambda_2 \approx \lambda_3 \gg 0$}    \\
\bottomrule
\end{tabular*}
% \caption{增强不同形状所需的特征值}
\end{table}

% \subsection{水平集演进之前的预处理}
% \label{subsec:coronary_enhanced_preprocessing}

% \subsubsection{特征图像的计算}
% \label{subsubsec:coronary_enhanced_feature_image}

% 本部分所用方法与第\ref{subsec:aorta_edge_potential}节类似，此处不再赘述。

% \subsubsection{一种改进的Fast Marching方法}
% \label{subsec:coronary_enhanced_colliding_fronts}

% 波面碰撞（colliding fronts）――一种改进的快速行进法，其目的是为后续的分割工作生成输入水平集。
% 这种方法的实现建立在经典的快速行进法\cite{Sethian1999}的基础上。
% 与经典方法不同的是，在同一轮计算中，我们可以同时为其提供两个种子点，两个种子点就意味着两个波面同时传播，直到它们相互“碰撞”为止。
% 这样，我们就可以较快地获得水平集结果。

% \subsection{CURVES演进模型}

% 本部分所采用的方法与第\ref{subsec:coronary_CURVES}节相同，此处不再赘述。

% \subsection{等值面渲染}

% 本部分所用方法与第\ref{subsec:aorta_isosurface}节相同，此处不再赘述。
