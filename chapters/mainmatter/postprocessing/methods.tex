
\section{血管表面模型后处理流程设计}
\label{sec:postprocessing_pipeline}

\subsection{后处理管线的设计}

图\ref{fig:mesh_data_flow}给出了在实际削减模型的多边形之前所必需完成的预处理工作的流程。
首先，需要对基于CTA的血管模型中的顶点的连接性进行检验，以确保要处理的表面是一体的，并且其中所有的顶点都是连通的。
其次，引入平滑算法以处理模型表面的“毛刺”和“凹陷”等不平整的区域。
最后，对表面模型的多边形面片进行削减，同时，血管模型的几何特征得到最大限度的保护。
\begin{figure}[ht]
\centering
\input{FigureSrc/postprocessing/mesh/data_flow}
% \includegraphics[width=3.2in]{Figures/postprocessing/mesh/DataFlow.eps}
\caption[血管表面模型优化流程]{血管表面模型优化流程。}
\label{fig:mesh_data_flow}
\end{figure}

在进行实际的中心线提取之前，我们需要对之前基于CTA的可视化模型进行降噪和平滑，以确保输入表面数据的质量。
这些对基于CTA的血管表面模型的预处理流程如图\ref{fig:centerlines_data_flow}所示。
首先，检验表面模型中各个顶点的连接性，从而除去双层以及悬浮面片，以获得表面的最大连接区域。
第二，对检验后的表面进行平滑处理，以除去表面模型上的“毛刺”和“台阶”等噪声，确保中心线提取运算的准确性。
第三，计算所得表面模型的法向量，以表明表面的“内部”和“外部”。
最后，对表面模型进行细分，保证中心线提取数值计算的稳定性。
\begin{figure}[ht]
\centering
\input{FigureSrc/postprocessing/centerlines/data_flow}
% \includegraphics[width=3.2in]{Figures/postprocessing/centerlines/DataFlow.eps}
\caption[表面模型中心线提取流程]{表面模型中心线提取流程。}
\label{fig:centerlines_data_flow}
\end{figure}

\subsection{多边形精简算法}
\label{sec:mesh_decimation}

为了削减构成表面模型的多边形总数，我们采用了一种削减三角形网格的算法\cite{Schroeder1992}。
该算法的思路是：首先删除坐标已经被检验的顶点，然后再通过在漏洞位置创建新的三角化网格来进行修补。
% \begin{figure}[t]
% \centering
% \subfloat[]{
% \input{FigureSrc/postprocessing/mesh/GeneralSimple}
% \label{fig:mesh_general_simple}
% }
% \hfil
% \subfloat[]{
% \input{FigureSrc/postprocessing/mesh/Complex}
% \label{fig:mesh_complex}
% }
% \hfil
% \subfloat[]{
% \input{FigureSrc/postprocessing/mesh/Boundary}
% \label{fig:mesh_boundary}
% }
% \hfil
% \subfloat[]{
% \input{FigureSrc/postprocessing/mesh/InteriorEdge}
% \label{fig:mesh_interior_edge}
% }
% \hfil
% \subfloat[]{
% \input{FigureSrc/postprocessing/mesh/Corner}
% \label{fig:mesh_corner}
% }
% \caption[表面中顶点位置的五种情形]{表面中顶点位置的五种情形。(a) 简单情形；(b) 复杂情形；(c) 边缘情形；(d) 边缘内部情形；(e) 拐角情形。}%
% \label{fig:mesh_five_classes}
% \end{figure}

如图\ref{fig:mesh_five_classes}所示，所有的顶点被归为简单，复杂，以及拐角三种类型。
其中，简单顶点又可以进一步被分为边缘顶点和边缘内部顶点。
\begin{figure}[ht]
\centering
\subfloat[]{
\input{FigureSrc/postprocessing/mesh/GeneralSimple}
\label{fig:mesh_general_simple}
}
\hfil
\subfloat[]{
\input{FigureSrc/postprocessing/mesh/Complex}
\label{fig:mesh_complex}
}
\hfil
\subfloat[]{
\input{FigureSrc/postprocessing/mesh/Boundary}
\label{fig:mesh_boundary}
}
\hfil
\subfloat[]{
\input{FigureSrc/postprocessing/mesh/InteriorEdge}
\label{fig:mesh_interior_edge}
}
\hfil
\subfloat[]{
\input{FigureSrc/postprocessing/mesh/Corner}
\label{fig:mesh_corner}
}
\caption[表面中顶点位置的五种情形]{表面中顶点位置的五种情形。(a) 简单情形；(b) 复杂情形；(c) 边缘情形；(d) 边缘内部情形；(e) 拐角情形。}%
\label{fig:mesh_five_classes}
\end{figure}

为删除那些不重要的顶点，就需要设计某种判定准则，并将其应用于验证模型内所有潜在目标的几何特征。
首先，复杂顶点是必须保留的。
然后，其余的顶点则需要通过检验来决定其保留与否。
其中，对于不位于边缘和边缘内部的简单顶点来说，其与平均平面的距离是该检验的唯一原则――如果该距离小于某个设定值，该顶点即被保留；反之，该顶点则被删除。
位于边缘和边缘内部的顶点也利用类似的方法来检验――如果这些类型的顶点到平均平面的距离小于某一设定值，那么该顶点同样被保留；反之，该顶点将被剔除。
一般情况下，位于拐角处的顶点被保留下来，用来保持削减结果表面对输入表面的几何特征的准确估计，或者留下那些在建模过程中所引入的“噪声”，稍后再采用更加妥当的方法进行处理。

% \begin{figure}[t]
% \centering
% \subfloat[]{
% \input{FigureSrc/postprocessing/mesh/SimpleReduction}
% \label{fig:mesh_simple_reduction}
% }
% \hfil
% \subfloat[]{
% \input{FigureSrc/postprocessing/mesh/BoundaryReduction}
% \label{fig:mesh_boundary_reduction}
% }
% \caption[削减顶点引起的多边形减少]{削减顶点引起的多边形减少。(a) 简单情形：削减前的多边形数量：$6$，削减后的多边形数量：$4$；(b) 边缘情形：削减前的多边形数量：$5$，削减后的多边形数量：$4$。注意：在削减计算之前，红色的边并不属于表面。}%
% \label{fig:mesh_reduction}
% \end{figure}

一旦删除某个顶点与之关联的边，表面上就会留下一个（简单情形）或两个（边缘情形或者边缘内部情形）漏洞需要修补。
为了修补这些新生成的漏洞，算法会在这些区域中创建新的三角化网格，而这一步骤是在实际删除步骤开始之前就完成的。

对比这一过程前后的三角形面片的数量可知，对于一般简单顶点，边缘内部顶点，以及某些拐角顶点，减少了两个三角形面片；而对于边缘顶点的情形，只减少了一个三角形面片（见图\ref{fig:mesh_reduction}）。
\begin{figure}[ht]
\centering
\subfloat[]{
\input{FigureSrc/postprocessing/mesh/SimpleReduction}
\label{fig:mesh_simple_reduction}
}
\hfil
\subfloat[]{
\input{FigureSrc/postprocessing/mesh/BoundaryReduction}
\label{fig:mesh_boundary_reduction}
}
\caption[削减顶点引起的多边形减少]{削减顶点引起的多边形减少。(a) 简单情形：削减前的多边形数量：$6$，削减后的多边形数量：$4$；(b) 边缘情形：削减前的多边形数量：$5$，削减后的多边形数量：$4$。注意：在削减计算之前，红色的边并不属于表面。}%
\label{fig:mesh_reduction}
\end{figure}
