
\section{解决方案}
\label{sec:solutions}

针对第\ref{subsec:requirements}节所列出各项需求，我们首先给出如下的基本方案，较为详细的说明将在本节随后给出：
\begin{itemize}
  \item 基于医学体数据的人体解剖结构的分割与可视化：
  \begin{itemize}
    \item 主动脉内腔的分割与心脏近似轮廓的分割（见第\ref{chap:aorta}章）；
    \item 冠状动脉树状结构的分割（见第\ref{chap:coronary}章）。
  \end{itemize}
  \item 面向交互仿真的血管系统模型的优化及几何信息提取（见第\ref{chap:postprocessing}章）。
\end{itemize}

\subsection{解剖结构的分割与可视化}

一种常见的获得血管模型的基本过程是\cite{Preim2008Review}：
\begin{enumerate}
  \item 原始医学体数据集的预处理；
  \item 体数据中表示血管系统的像素的分割；
  \item 基于分割结果的血管系统的重建。
\end{enumerate}
在本文工作中，我们在此思路的基础上，提出一系列具体的处理方法，对现有真实病例的原始数据进行处理，最终得到血管等人体器官的表面模型。

对原始医学数据的预处理主要包括：降噪，阈值滤波，图像恢复，重采样，梯度计算，非线性映射，数学形态学处理等环节。
它们的作用是改善图像质量，突出感兴趣的图像细节，从而为后续的图像分割步骤提供基础。

图像分割是图像处理领域中一项极富挑战性的任务。
到目前为止，尚无任何一种通用的方法能够应付多数的分割任务。
图像分割方法大致可分为：基于区域的图像分割，基于边界的图像分割，以及混合方法等。
本文工作所采用的主要方法属于基于边界的图像分割方法的范畴。

快速行进算法（Fast Marching）是一种基于几何形变模型的分割方法\cite{Sethian1999}。
几何形变模型的理论基础是曲线演化理论和水平集方法。
几何形变模型的基本思想是将曲线的形状变化用曲线演化理论来描述，即用曲率或向量等几何量度来表示曲线或曲面演化的速度函数，并将此速度函数与图像数据关联起来，从而使曲线在对象边缘处停止演化。
由于曲线的演化与参数无关，几何形变模型能自动处理对象拓扑的关系，演化过程中的曲线和曲面只能被隐式地表示为一个更高维函数的水平集，因此曲线演化过程采用了水平集方法实现。
而快速行进算法跟踪运动曲线或曲面的方式是固定曲线或者曲面的演化方向，也就是说，曲线或者曲面在演化过程中只能收缩（或者只能扩张）。

测地活动轮廓（GAC）\cite{Caselles1997}是一种改进的经典“蛇”模型\cite{Kass1988}。
经典的“蛇”（或活动轮廓模型）主要用于图像中的物体边缘的探测，其主导思想是通过演进一个轮廓（或“围线”）$\mathcal{C}$，以检测得出目标物体的边缘信息。
这一演进过程实际上是通过使一个能量泛函最小化来实现的，取得这个（局部）最小值的位置恰好是目标物体的边缘。
GAC模型引入了测地计算和水平集演进的概念，其数学模型事实上是经典模型的一个特例。
该方法克服了经典方法在演进过程中，轮廓无法控制其自身的拓扑的问题，这也意味着它允许围线同时探测图像中的多个目标的内部边缘和外部边缘。

CURVES\cite{Lorigo2001}是对GAC的一项改进。
作为GAC的一项扩展研究，CURVES也是一种水平集算法，它将细微的血管抽象为具有任意复杂度的拓扑结构的空间曲线\cite{Lorigo2001}。
它对分割立体医学数据中的复杂线状结构十分有效。
此外，该方法的准则还考虑到了欲分割目标边缘的局部平滑性，从而进一步提高了分割结果的准确性。

在分割所得目标像素的基础上，我们提取目标的边缘，并在虚拟场景中渲染出分割所得到的模型。
鉴于训练系统的需求，本文在提取目标边缘（即“等值线”或“等值面”）方面所采用的方法基于行进立方体方法（Marching Cubes）\cite{Lorensen1987MC}。
该方法的基本原理是：采用隐式的等值面提取方法从体数据中获取等值的信息。
该算法需要用户提供一个阈值，也就是所希望提取出来的物质的密度，然后根据体数据的信息，就可以把相应阈值内的数据全部提取出来，并且通过三角网格（即多边形面片）表示出来。
最后，这些多边形被通过面绘制方法在显示设备上显示，从而得到分割结果（即心血管系统）的表面模型。

\subsection{模型优化与形状信息提取}

对于训练系统，我们要求血管模型与虚拟工具之间的交互过程应该足够流畅。
由此，在血管系统的建模方面，我们需要对经由上述流程获得血管模型的数据进行“无损”精简和优化；
同时，在虚拟工具的建模方面，我们则需要选择合适的建模方式和碰撞检测方式，并对手术工具模型本身进行后期优化。
通过这两方面的努力，才能使两者交互时，每一步碰撞检测所涉及数据尽可能小，从而降低该过程对系统资源的过度占用以及由此导致的卡顿，甚至死机。

训练系统的虚拟解剖环境不仅提供直观的视觉感受，还需要提供这些可视化结果的几何信息。
为提取血管表面模型的中心线等几何信息，我们提出了基于Voronoi图的中心线提取方法。
该方法对血管模型内部空间进行Voronoi划分，并在此基础上运用类水平集演进的方法得到模型的中心线\cite{Antiga2003}。

上述模型优化和形状信息提取两方面工作的预处理是类似的。
首先检测已经获得的血管系统表面模型中所有顶点的连接性；
然后进行模型表面局部的平整处理，除去噪声干扰。

接下来，在模型优化方面，我们引入表面精简算法进行模型优化处理，最后得到精简后的表面模型。
而在形状信息提取方面，我们对模型表面进行全局细分处理。
然后再构建表面模型内部空间的Voronoi划分，并基于这一划分进行类似水平集演进的计算，最后得到血管模型的中心线。

